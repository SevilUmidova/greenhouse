<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Remote Water Tap + Sensors</title>
<style>
:root{
  --bg:#0d1117;--card:#161b22;--text:#e6edf3;--subtext:#9ba6b4;
  --accent-blue:#2389ff;--accent-red:#ff3b4f;--tile-bg:#1c222c;
}
body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0}
.card{max-width:720px;margin:48px auto;background:var(--card);border-radius:14px;padding:28px;box-shadow:0 0 0 1px rgba(255,255,255,0.02)}
h1{text-align:center;margin:0 0 8px;font-weight:800}
.muted{text-align:center;color:var(--subtext)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-top:22px}
.tile{background:var(--tile-bg);border-radius:12px;padding:14px;text-align:center}
.tile .label{font-size:12px;color:var(--subtext);margin-bottom:6px}
.tile .value{font-size:20px;font-weight:700;color:var(--text)}
.controls{text-align:center;margin-top:22px}
button{border:0;padding:10px 18px;border-radius:8px;margin:8px;font-weight:600;cursor:pointer}
.open{background:var(--accent-blue);color:#fff}
.close{background:var(--accent-red);color:#fff}
#status{margin-top:10px;font-size:14px;color:var(--subtext);height:18px}
.rawline{margin-top:18px;font-size:13px;color:var(--subtext);text-align:center;word-break:break-word}
</style>
</head>
<body>
<div class="card">
  <h1>Remote Electricity Control</h1>
  <p class="muted"><b></b></p>

  <div class="grid" aria-live="polite">
    <div class="tile"><div class="label">Water Level %</div><div id="soil" class="value">--</div></div>
    <div class="tile"><div class="label">Temp °C</div><div id="temp" class="value">--</div></div>
    <div class="tile"><div class="label">Light %</div><div id="light" class="value">--</div></div>
    <div class="tile"><div class="label">Salt</div><div id="salt" class="value">--</div></div>
  </div>

  <div class="controls">
    <button id="open" class="open">Open Gas</button>
    <button id="close" class="close">Close Gas</button>
    <div id="status"></div>
  </div>

  <div class="rawline"><strong>Last raw:</strong> <span id="raw">—</span></div>
  <p class="muted" style="margin-top:12px"></p>
</div>

<script>
const soilEl = document.getElementById('soil');
const tempEl = document.getElementById('temp');
const lightEl = document.getElementById('light');
const saltEl = document.getElementById('salt');
const rawEl = document.getElementById('raw');
const status = document.getElementById('status');

async function fetchLatest(){
  try{
    const r = await fetch('/.netlify/functions/get-latest');
    if (!r.ok) throw new Error('fetch failed');
    const j = await r.json();
    soilEl.textContent = j.soil ?? '--';
    tempEl.textContent = j.temp ?? '--';
    lightEl.textContent = j.light ?? '--';
    saltEl.textContent = j.salt ?? '--';
    rawEl.textContent = (j && (j.soil||j.temp||j.light||j.salt)) ? JSON.stringify(j) : '--';
  }catch(e){
    // keep showing old values
    rawEl.textContent = 'Error';
  }
}

async function sendCmd(c){
  status.textContent = 'Sending '+c+'…';
  try{
    const r = await fetch('/.netlify/functions/send-command', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({cmd: c})
    });
    const j = await r.json();
    if (r.ok) status.textContent = 'Sent';
    else status.textContent = 'Error';
  }catch(e){
    status.textContent = 'Error';
  }
  setTimeout(()=>status.textContent='', 1800);
}

document.getElementById('open').onclick = ()=> sendCmd('OPEN');
document.getElementById('close').onclick = ()=> sendCmd('CLOSE');

setInterval(fetchLatest, 1500);
fetchLatest();
</script>
</body>
</html>






